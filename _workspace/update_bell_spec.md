# おしらせベル アプリケーション仕様書

**最終更新**: 2025-08-13  
**バージョン**: 1.0.0  
**実装状況**: Phase 1-2 完全実装済み

---

## 📋 プロジェクト概要

ユーザーが指定した周期で、指定したURLへのリンクをプッシュ通知するPWAアプリケーション。GitHub Pagesで公開し、PC/スマホ/タブレットで利用可能。

**コンセプト**: ウェブ漫画の更新チェック、新商品の発売確認、イベント開催チェックなど、定期的に確認したいウェブページを忘れずにチェックできるリマインダーアプリ。

---

## 🎯 主要機能仕様

### **基本機能**
- **リマインダー管理**: 作成・編集・削除・一時停止・複製機能
- **柔軟な周期設定**: 毎日・数日ごと・毎週・特定曜日複数選択・毎月（第n曜日）
- **プッシュ通知**: 指定時刻にブラウザ通知（Service Worker）
- **タグ機能**: 分類・検索・フィルター対応
- **テーマ切り替え**: ライト/ダーク/システム準拠
- **PWA対応**: オフライン動作・インストール可能・ホーム画面追加
- **データ管理**: JSON エクスポート/インポート（重複処理含む）
- **タイムゾーン管理**: 移動時の自動検出・調整ダイアログ

### **通知システム仕様**
- **タイミング精度**: 指定時刻ピッタリ（秒単位）
- **通知頻度**: 1回のみ（確認済み状態は実装しない設計）
- **ブラウザ制約**: 未起動時は制限あり（PWAインストール推奨）
- **Service Worker**: 本番環境でのみ動作、定期チェック機能付き

### **周期設定詳細**
- **毎日**: 指定時刻に毎日通知
- **数日ごと**: n日間隔での通知（2〜365日）
- **毎週○曜日**: 特定の曜日に通知
- **毎週☆曜日（複数）**: 複数の曜日を選択して通知
- **毎月第△週◇曜日**: 月の第n週の特定曜日に通知（第5週選択不可）

---

## 🏗️ 技術アーキテクチャ

### **フロントエンド構成**
- **フレームワーク**: React 18 + TypeScript
- **スタイリング**: Tailwind CSS（ユーティリティファースト）
- **ビルドツール**: Vite 4.4.0（高速開発・ビルド）
- **状態管理**: React Hooks（カスタムフック活用）
- **アイコンライブラリ**: Lucide React 0.263.1

### **PWA技術スタック**
- **PWAプラグイン**: vite-plugin-pwa 0.16.0
- **Service Worker**: Workbox ベース
- **通知API**: Web Notifications API
- **オフライン対応**: Cache-First戦略

### **データ管理設計**
- **ストレージ**: LocalStorage（ユーザー登録不要）
- **データ形式**: JSON（エクスポート/インポート対応）
- **状態管理**: カスタムフック（useReminders, useSettings, useTheme, useTimezone）
- **永続化**: ブラウザローカルストレージ

### **デプロイ・ホスティング**
- **ホスティング**: GitHub Pages
- **自動デプロイ**: GitHub Actions
- **ベースURL**: 相対パス（`./`）設定
- **ビルド最適化**: コード分割・最小化・ソースマップ無効

---

## 📱 ユーザー体験設計

### **ダッシュボード仕様**
- **並び順**: 最終通知日時の新→古順
- **表示情報**: 最終通知日時・次回通知日時・タイトル・URL・タグ
- **検索・フィルター**: タイトル・URL・タグ・一時停止状態での絞り込み
- **操作**: 編集・削除・複製・一時停止・URL直接アクセス

### **モバイル対応**
- **レスポンシブデザイン**: Tailwind CSS使用
- **PWA機能**: マニフェスト・アイコン・ショートカット完備
- **インストール推奨**: 通知の安定性向上のため

### **テーマ対応**
- **ライトモード**: デフォルト
- **ダークモード**: ユーザー選択
- **システム準拠**: OS設定に自動追従

---

## 💾 データ管理仕様

### **エクスポート機能**
- **ファイル形式**: JSON
- **ファイル名**: `update-bell-YYYY-MM-DD.json`
- **含有データ**: リマインダー・設定・テーマ・メタデータ
- **メタデータ**: UserAgent、タイムゾーン、エクスポート日時
- **バージョン管理**: 1.0.0形式

### **インポート機能**
- **重複判定**: URLの完全一致
- **重複処理選択**: ユーザー選択（上書き・スキップ・追加）
- **形式検証**: JSON形式・型検証・エラーハンドリング
- **状態表示**: 成功・エラー・進捗表示

### **バックアップ戦略**
- **推奨頻度**: UIでの定期バックアップ案内
- **リスク**: ブラウザキャッシュ削除での消失可能性
- **対策**: 定期エクスポートの推奨

---

## 🔔 PWA・Service Worker仕様

### **Service Worker設計**
- **動作環境**: 本番環境のみ登録（開発時は無効）
- **キャッシュ戦略**: Workbox使用
  - 静的リソース: Cache First
  - 動的コンテンツ: Network First
- **通知処理**: バックグラウンド実行・定期チェック

### **マニフェスト設定**
- **アプリ名**: 「おしらせベル」
- **アイコン**: 72x72〜512x512（マスク対応含む）
- **ショートカット**: 新規作成・設定画面への直接アクセス
- **スクリーンショット**: モバイル・デスクトップ対応
- **プロトコルハンドラー**: web+bell対応

### **通知許可・設定**
- **通知許可**: 初回アクセス時のブラウザ通知APIリクエスト
- **チェック間隔**: 15分〜2時間（ユーザー設定可能）
- **バッテリー配慮**: 設定画面での消費量案内表示

---

## ⏸️ 一時停止機能仕様

### **設計目的**
- **漫画休載対応**: 休載期間中の不要通知回避
- **個別制御**: リマインダーごとの独立制御

### **実装仕様**
- **状態管理**: isPausedフラグによる管理
- **UI表示**: 一時停止中の明確な視覚的表示
- **再開機能**: ワンクリック再開・状態復帰

---

## 🌍 タイムゾーン対応仕様

### **基本設計**
- **動作基準**: ユーザーの現在タイムゾーンで動作
- **自動検出**: ブラウザAPIによるタイムゾーン取得
- **精度**: 秒単位での正確な時刻管理

### **移動時対応**
- **自動検出頻度**: 1時間ごとのタイムゾーンチェック
- **変更ダイアログ**: 影響するリマインダーの表示・説明
- **調整オプション**: 現地時刻維持・元時刻維持の選択可能

---

## 🔧 技術的制約・注意事項

### **ブラウザ依存制約**
- **通知制限**: ブラウザ未起動時の通知制限
- **PWA推奨**: より安定した通知のためのインストール推奨
- **オフライン**: データ閲覧・編集は可能、通知は制限

### **アプリ更新機能**
- **自動更新**: vite-plugin-pwa（registerType: 'autoUpdate'）
- **キャッシュ管理**: cleanupOutdatedCaches有効
- **ユーザー体験**: シームレスな更新

### **開発環境制約**
- **開発時PWA**: 機能無効（devOptions.enabled: false）
- **Node.js要件**: 18.0.0以上

---

## 🔮 将来拡張ロードマップ

### **優先度：高**
- **外部プッシュ通知**: より確実な通知のため（Web Push API等）
- **通知詳細設定**: 通知音・バイブレーション・表示時間等の設定
- **UI/UX改善**: ユーザビリティ向上・アクセシビリティ対応

### **優先度：中**
- **QRコードエクスポート/インポート**: プライバシー保護データ移行
  - デバイス間データ共有の簡便化
  - インターネット不要・完全オフライン動作
  - セキュリティ面での安心設計
- **リマインダーテンプレート**: よく使用する設定の保存・再利用
- **通知内容カスタマイズ**: メッセージテンプレート機能

### **優先度：検討中**
- **複数デバイス間同期**: 利便性vs実装コストの兼ね合い検討
  - 簡易案：QRコード手動データ移行
  - 本格案：クラウドストレージ連携（Google Drive API等）

### **技術的考慮事項**
- **API拡張余地**: 型定義による将来対応の維持
- **パフォーマンス**: 大量データ対応・メモリ使用量削減
- **セキュリティ**: データ暗号化・プライバシー保護強化
- **QR実装**: qrcode.js等の軽量ライブラリ活用

---

*仕様書 v1.0.0 - 2025-08-13*  
*実装状況: 全機能完全実装済み*